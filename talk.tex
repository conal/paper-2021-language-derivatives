%% Style copied from https://github.com/omelkonian/presentations/tree/master/%5B2019.08.20%5D%20BitML%20(SRC%20Presentation%20%40%20ICFP))

%% \documentclass[aspectratio=43]{beamer}
\documentclass[aspectratio=169]{beamer}

\usetheme[
  block=fill,
  background=light,
  % titleformat=smallcaps,
  progressbar=frametitle,
  numbering=none,
]{metropolis}
\setbeamersize{text margin left=.5cm,text margin right=.5cm}

\let\note\undefined

\usepackage{catchfilebetweentags}
\usepackage[useregional]{datetime2}

\RequirePackage{newunicodechar, amssymb, stmaryrd, unicode-math, setspace, comment}

%% \renewcommand\alert[1]{\textcolor{mLightBrown}{#1}}

\input{commands}
\input{unicode}
\input{macros}

\usepackage{agda}% references

%% \renewcommand{\AgdaFontStyle}[1]{\text{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Fonts
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% \usepackage{relsize}
\usepackage{libertine}  %% [tt=false]
%% \usepackage[libertine]{newtxmath}

%----------------------------------------------------------------------------

\title{Symbolic and Automatic Differentiation of Languages}
% \subtitle{...}
\author{Conal Elliott}
\date{Early draft of \DTMnow}
%% \titlegraphic{
%% \vspace*{7cm}
%% \includegraphics[keepaspectratio=true,height=1.4cm]{uu}
%% \hspace{1cm}
%% \includegraphics[keepaspectratio=true,height=1.4cm]{iohk}


\begin{document}

\begin{center}
\setbeamerfont{title}{size=\large}
\setbeamerfont{subtitle}{size=\small}
\maketitle
\setbeamerfont{title}{size=\Large}
\setbeamerfont{subtitle}{size=\large}
\end{center}

\rnc\source{Language}

\begin{frame}{Languages via type theory}
\setstretch{0.8}
\vspace{1.5ex}
A language is a predicate on ``strings'' yielding proofs/explanations/parsings:
\agda{Lang}

The usual language building blocks:
\vspace{-2ex}

\agda{Lang-ops}

\emph{Puzzle:} how to decide (compute) inhabitation?
\end{frame}

\rnc\source{Calculus}

\begin{frame}{Decomposing languages (list consumers)}
\vspace{2ex}
Consider each list constructor:
\vspace{1.5ex}
\agda{νδ}

\vspace{2ex}
\AF{ν} and repeated \AF{δ} capture list consumers fully:

\vspace{-2ex}
\begin{minipage}[c]{2.8in}
\agda{ν∘foldlδ}
\end{minipage}
\hfill
\begin{minipage}[c]{2.5in}
%% \vspace{-4ex}
\mathindent0ex
\agda{foldl}
\end{minipage}
\hfill\ 
\end{frame}

\begin{frame}{Language calculus}
\vspace{-1ex}
\vfill
\mathindent0ex
\agda{νδ-lemmas}
\end{frame}

\rnc\source{Decidability}

\begin{frame}{Decidable types}
\agda{Dec}
\hfill\ 
\vspace{-1.5ex}

Compositionally,

\agda{Decs}

Isomorphisms:

\agda{isomorphisms}
\end{frame}

\begin{frame}{Compositionally decidable types}
\vspace{3ex}
\agda{compositional-dec}
%% Wait until I'm ready to talk about algebra
%% Another closed semiring!
\end{frame}

\rnc\source{Reflections}

\begin{frame}{Reflections}
\vspace{1.5ex}
\agda{summary}

\AF{ν} and \AF{δ} are \emph{higher-order functions}.
How to apply these rules?

Same challenge in differential calculus.

Solve via \emph{symbolic} or \emph{automatic} differentiation.
%% We to \emph{reflect} functions back to recipes.
\end{frame}

\rnc\source{Symbolic}

\begin{frame}{Regular expressions \hfill (inductive)}
\hypertarget{regex}{}
\mathindent0ex
\vspace{0.5ex}
\setstretch{1.0}
\agda{api}
\vfill
\end{frame}

\begin{frame}{Symbolic differentiation \hfill (column-major / patterns)}
\hypertarget{symbolic-diff}{}
\mathindent0ex
\vspace{-2ex}
\agda{defs}
\hfill\;
\end{frame}

\rnc\source{Automatic}

\begin{frame}{Tries \hfill \hyperlink{regex}{(coinductive)}}
\mathindent0ex
\vspace{-1.5ex}
\setstretch{1.0}
\agda{api}
\vspace{2ex}
\end{frame}

%<*rules>
\newcommand\rules[2]{
\hspace{0ex}\\% Weirdness fix
\hspace{0.00ex}
\hfill
\begin{minipage}{2.2in}
#1
\end{minipage}
\hfill
\begin{minipage}{3in}
#2
\end{minipage}
\hfill\;
\vspace{-4.57ex}
}
%</rules>

%% \agda{rules}

\begin{frame}{Automatic differentiation \hfill (row-major \hyperlink{symbolic-diff}{/} copatterns)}
\hypertarget{automatic-diff}{}
\mathindent0ex
\vspace{-6.3ex}
\setstretch{1.6}
\agda{defs}
\end{frame}

\begin{frame}{Termination checking}
Agda cannot prove termination for the {\AFi{δ} (\AB{p} \AF{⋆} \AB{q})} clause:
\agda{termination}
\vfill
Andreas Abel solved this puzzle using sized types:
\begin{center}
\emph{\href{http://www.cse.chalmers.se/~abela/jlamp17.pdf}{Equational reasoning about formal languages in coalgebraic style}} (2016).
\end{center}
\end{frame}

\rnc\source{SizedAutomatic}

\begin{frame}{Sized tries \hfill (coinductive)}
\mathindent0ex
\vspace{-1.5ex}
\setstretch{1.0}
\agda{api}
\vspace{2ex}
\end{frame}

\begin{frame}{Automatic differentiation (sized) \hfill (row-major \hyperlink{automatic-diff}{/} copatterns)}
\mathindent0ex
\vspace{-6.3ex}
\setstretch{1.6}
\agda{defs}
\end{frame}

\end{document}
