%% Style copied from https://github.com/omelkonian/presentations/tree/master/%5B2019.08.20%5D%20BitML%20(SRC%20Presentation%20%40%20ICFP))

%% \documentclass[aspectratio=43]{beamer}
\documentclass[aspectratio=169]{beamer}

\usetheme[
  % block=fill,
  % background=light,
  % titleformat=smallcaps,
  % progressbar=frametitle,
  % numbering=none,
]{metropolis}%Warsaw,Madrid
\setbeamersize{text margin left=.5cm,text margin right=.5cm}

\usepackage{catchfilebetweentags}
\usepackage[useregional]{datetime2}

\RequirePackage{newunicodechar, amssymb, stmaryrd, unicode-math, setspace, comment}

%% \renewcommand\alert[1]{\textcolor{mLightBrown}{#1}}

\input{commands}
\input{unicode}
\input{macros}

\usepackage{libertine}  %% [tt=false]
\usepackage{agda}% references

%% \renewcommand{\AgdaFontStyle}[1]{\text{#1}}

%----------------------------------------------------------------------------

\title{Symbolic and Automatic Differentiation of Languages}
% \subtitle{...}
\author{Conal Elliott}
\date{Early draft of \DTMnow}
%% \titlegraphic{
%% \vspace*{7cm}
%% \includegraphics[keepaspectratio=true,height=1.4cm]{uu}
%% \hspace{1cm}
%% \includegraphics[keepaspectratio=true,height=1.4cm]{iohk}


\begin{document}

\begin{center}
\setbeamerfont{title}{size=\large}
\setbeamerfont{subtitle}{size=\small}
\maketitle
\setbeamerfont{title}{size=\Large}
\setbeamerfont{subtitle}{size=\large}
\end{center}

\rnc\source{Language}

\begin{frame}{Languages via type theory}
\setstretch{0.8}
\vspace{1.5ex}
A language is a predicate on ``strings'' yielding proofs/explanations/parsings:
\vspace{1ex}
\agda{Lang}

The usual language building blocks:
\vspace{-2ex}

\agda{Lang-ops}

\vspace{-1ex}
\emph{Puzzle:} how to decide (compute) inhabitation?
\end{frame}

\rnc\source{Calculus}

\begin{frame}{Decomposing languages (list consumers)}
\vspace{2ex}
Consider each list constructor:
\vspace{1.5ex}
\agda{ŒΩŒ¥}

\vspace{2ex}
\AF{ŒΩ} and repeated \AF{Œ¥} capture list consumers fully:

\vspace{-1ex}
\begin{minipage}[c]{2.8in}
\agda{ŒΩ‚àòfoldlŒ¥}
\end{minipage}
\hfill
\begin{minipage}[c]{2.5in}
\mathindent0ex
\agda{foldl}
\end{minipage}
\hfill\;
\end{frame}

\begin{frame}{Language calculus}
\vspace{-1ex}
\vfill
\agda{ŒΩŒ¥-lemmas}
\end{frame}

\rnc\source{Decidability}

\begin{frame}{Decidable types}
\begin{minipage}{2in}
\agda{Dec}
\end{minipage}
\hfill
\begin{minipage}{2in}
\vspace{6.3ex}
(\agda{¬¨})
\end{minipage}
\hfill\;

For computable parsing,
\agda{Decidable}

Isomorphisms:

\agda{isomorphisms}
\end{frame}

\begin{frame}{Compositionally decidable types}
\vspace{3ex}
\agda{compositional-dec}
%% Wait until I'm ready to talk about algebra
%% Another closed semiring!
\end{frame}

\rnc\source{Reflections}

\begin{frame}{Reflections}
\vspace{1.5ex}
\agda{summary}

\AF{ŒΩ} and \AF{Œ¥} are \emph{higher-order functions}.
How to apply these rules?

Same challenge in differential calculus.

Solve via \emph{symbolic} or \emph{automatic} differentiation.
%% We to \emph{reflect} functions back to recipes.
\end{frame}

\rnc\source{Symbolic}

\begin{frame}{Regular expressions \hfill (inductive)}
\hypertarget{regex}{}
\vspace{0.5ex}
\setstretch{1.0}
\agda{api}
\end{frame}

\begin{frame}{Symbolic differentiation \hfill (column-major / patterns)}
\hypertarget{symbolic-diff}{}
\mathindent0ex
\vspace{-2ex}
\agda{defs}
\end{frame}

\rnc\source{Automatic}

\begin{frame}{Tries \hfill \hyperlink{regex}{(coinductive)}}
\vspace{-1.5ex}
\setstretch{1.0}
\agda{api}
\vspace{2ex}
\end{frame}

\agda{rules}

\begin{frame}{Automatic differentiation \hfill (row-major \hyperlink{symbolic-diff}{/} copatterns)}
\hypertarget{automatic-diff}{}
\vspace{-1.75ex}
\agda{defs}
\end{frame}

\begin{frame}{Termination checking}
Agda cannot prove termination for the {\AFi{Œ¥} (\AB{p} \AF{‚ãÜ} \AB{q})} clause:
\agda{termination}
\vfill
Andreas Abel solved this puzzle using sized types:
\begin{center}
\emph{\href{http://www.cse.chalmers.se/~abela/jlamp17.pdf}{Equational reasoning about formal languages in coalgebraic style}} (2016).
\end{center}
\end{frame}

\rnc\source{SizedAutomatic}

\begin{frame}{Sized tries \hfill (coinductive)}
\vspace{-1.5ex}
\setstretch{1.0}
\agda{api}
\vspace{2ex}
\end{frame}

\begin{frame}{Automatic differentiation (sized) \hfill (row-major \hyperlink{automatic-diff}{/} copatterns)}
\vspace{-1.75ex}
\agda{defs}
\end{frame}


\rnc\source{Predicate}

\begin{comment}
\begin{frame}{Two kinds of language operations}
Codomain transformations: \AF{‚àÖ}, \AF ùí∞, \AF{\_‚à™\_}, \AF{\_‚à©\_}

Domain transformations: \AF{ùüè}, \AF{\_‚ãÜ\_}, \AF{\_‚òÜ}
\end{frame}
\end{comment}

\begin{frame}{Generalize languages to predicates}
\begin{center}
\mathindent-12ex
\agda{Pred}
\end{center}
\vspace{-2ex}
\hfill
\mathindent0ex
\begin{minipage}[b]{16em}
%% Transform codomain: %\small
\agda{codomain-transformers}
\end{minipage}
\hfill
\begin{minipage}[b]{22em}
%% Transform domain: %\small
\agda{domain-transformers}
\end{minipage}
\hfill\;
\end{frame}

\begin{frame}{Specialize predicates to languages}
\mathindent0ex
\begin{center}
\mathindent-12ex
\agda{Lang}
\end{center}
\vspace{-2ex}
\hfill
\begin{minipage}[c]{10em}
\setstretch{1.7}
\agda{codomain-ops}
\end{minipage}
\hfill
\begin{minipage}[c]{18em}
\agda{list-ops}
\end{minipage}
\hfill\;
\end{frame}

\begin{frame}{Algebraic properties of languages}
\begin{itemize}\itemsep3ex
\item Predicates form a semimodule closed semiring:
\item Functions from monoids to semirings (e.g., languages) also form the \emph{monoid semring}.
\item Commutative if the monoid and semiring are.
\item Algebraic abstractions are simply typed, so existentially wrap decidable types.
\end{itemize}
\end{frame}

\rnc\source{Existential}

\begin{frame}{Transferring properties}

\agda{Dop}

% \agda{Semiring}

%% Copied
%<*Semiring>
\begin{code}%
%% \>[0]\AgdaKeyword{module}\AgdaSpace{}%
%% \AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaBound{r}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaRecord{Semiring}\AgdaSpace{}%
%% \AgdaGeneralizable{c}\AgdaSpace{}%
%% \AgdaGeneralizable{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaField{Semiring.Carrier}\AgdaSpace{}%
%% \AgdaBound{r}\AgdaSpace{}%
%% \AgdaSymbol{‚Üí}\AgdaSpace{}%
%% \AgdaPrimitiveType{Set}\AgdaSpace{}%
%% \AgdaGeneralizable{b}\AgdaSymbol{)}\AgdaSpace{}%
%% \AgdaKeyword{where}\<%
%% \\
%% \>[0][@{}l@{\AgdaIndent{0}}]%
%% \>[2]\AgdaKeyword{open}\AgdaSpace{}%
%% \AgdaModule{Semiring}\AgdaSpace{}%
%% \AgdaBound{r}\AgdaSpace{}%
%% \AgdaKeyword{hiding}\AgdaSpace{}%
%% \AgdaSymbol{(}isSemiringWithoutAnnihilatingZero\AgdaSymbol{)}\AgdaSpace{}%
%% \AgdaSymbol{;}\AgdaSpace{}%
%% \AgdaKeyword{open}\AgdaSpace{}%
%% \AgdaModule{Dop}\AgdaSpace{}%
%% \AgdaBound{f}\<%
%% \\
%% %
\>[2]\AgdaFunction{mkSemiring}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{D‚ÇÇ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}+\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{D‚ÇÇ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}*\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{D‚ÇÄ}\AgdaSpace{}%
\AgdaFunction{0\#}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{D‚ÇÄ}\AgdaSpace{}%
\AgdaFunction{1\#}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Semiring}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{‚Ñì}\<%
%% \\
%% %
%% \>[2]\AgdaFunction{mkSemiring}\AgdaSpace{}%
%% \AgdaOperator{\AgdaBound{\AgdaUnderscore{}+‚Ä≤\AgdaUnderscore{}}}\AgdaSpace{}%
%% \AgdaOperator{\AgdaBound{\AgdaUnderscore{}*‚Ä≤\AgdaUnderscore{}}}\AgdaSpace{}%
%% \AgdaBound{0\#‚Ä≤}\AgdaSpace{}%
%% \AgdaBound{1\#‚Ä≤}\AgdaSpace{}%
%% \AgdaSymbol{=}\AgdaSpace{}%
%% \AgdaKeyword{record}\<%
%% \\
%% \>[2][@{}l@{\AgdaIndent{0}}]%
%% \>[4]\AgdaSymbol{\{}%
%% \>[1125I]\AgdaField{isSemiring}\AgdaSpace{}%
%% \AgdaSymbol{=}\AgdaSpace{}%
%% \AgdaKeyword{record}\<%
%% \\
%% \>[1125I][@{}l@{\AgdaIndent{0}}]%
%% \>[8]\AgdaSymbol{\{}\AgdaSpace{}%
%% \AgdaField{isSemiringWithoutAnnihilatingZero}\AgdaSpace{}%
%% \AgdaSymbol{=}\AgdaSpace{}%
%% \AgdaFunction{isSemiringWithoutAnnihilatingZero}\<%
%% \\
%% %
%% \>[8]\AgdaSymbol{;}\AgdaSpace{}%
%% \AgdaField{zero}\AgdaSpace{}%
%% \AgdaSymbol{=}\AgdaSpace{}%
%% \AgdaFunction{prop‚ÇÅ}\AgdaSpace{}%
%% \AgdaFunction{zeroÀ°}\AgdaSpace{}%
%% \AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
%% \AgdaFunction{prop‚ÇÅ}\AgdaSpace{}%
%% \AgdaFunction{zero ≥}\<%
%% \\
%% %
%% \>[8]\AgdaSymbol{\}}\<%
%% \\
%% %
%% \>[4]\AgdaSymbol{\}}\AgdaSpace{}%
%% \AgdaKeyword{where}\AgdaSpace{}%
%% \AgdaKeyword{open}%
%% \>[1140I]\AgdaModule{SemiringWithoutAnnihilatingZero}\<%
%% \\
%% \>[1140I][@{}l@{\AgdaIndent{0}}]%
%% \>[20]\AgdaSymbol{(}\AgdaFunction{mkSemiringWithoutAnnihilatingZero}\<%
%% \\
%% \>[20][@{}l@{\AgdaIndent{0}}]%
%% \>[23]\AgdaFunction{semiringWithoutAnnihilatingZero}\AgdaSpace{}%
%% \AgdaBound{f}\AgdaSpace{}%
%% \AgdaOperator{\AgdaBound{\AgdaUnderscore{}+‚Ä≤\AgdaUnderscore{}}}\AgdaSpace{}%
%% \AgdaOperator{\AgdaBound{\AgdaUnderscore{}*‚Ä≤\AgdaUnderscore{}}}\AgdaSpace{}%
%% \AgdaBound{0\#‚Ä≤}\AgdaSpace{}%
%% \AgdaBound{1\#‚Ä≤}\AgdaSymbol{)}\<%
\end{code}
%</Semiring>

\end{frame}

\end{document}
